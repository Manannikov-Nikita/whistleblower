# Запись звука вкладки

Расширение для Google Chrome: записывает звук с текущей вкладки и (по желанию) ваш голос с микрофона в один файл — удобно для встреч и звонков.

## Установка

1. Откройте Chrome и перейдите в `chrome://extensions/`.
2. Включите **«Режим разработчика»** (переключатель справа вверху).
3. Нажмите **«Загрузить распакованное расширение»**.
4. Укажите папку с этим проектом (где лежит `manifest.json`).

После установки на панели расширений появится иконка расширения.

## Как пользоваться

1. Откройте вкладку со встречей/звонком (Zoom, Meet, Discord и т.п.).
2. **Клик по иконке расширения** — открывается выпадающее окно.
3. В окне: переключатель **«Записывать мой микрофон»** (вкл/выкл) и кнопка **«Начать запись»**.
4. Нажмите **«Начать запись»**. При первом включённом микрофоне браузер запросит разрешение на доступ к нему.
5. **Окно расширения можно закрыть** — запись продолжается в фоне.
6. Чтобы остановить: снова откройте иконку расширения и нажмите **«Остановить»** — запись передаётся в native host для обработки (формат WebM, кодек Opus).

Файл записи сохраняется в `output/session-*/audio.webm`. Результаты обработки — в той же папке.

## Автообработка (Native Messaging)

После остановки записи аудио сразу отправляется в native host и запускает обработку:

1. Установите native host:
   ```bash
   PYTHON_BIN="$(uv run python -c 'import sys; print(sys.executable)')" \
     bash native_host/install_native_host.sh
   ```
   По умолчанию используется фиксированный ID: `kboppgghhbphgciaolnfakeldpphpikg`.
   Чтобы переопределить:
   ```bash
   bash native_host/install_native_host.sh --extension-id <EXTENSION_ID>
   ```
3. Перезапустите Chrome.

Логи будут появляться в `output/native_host.log`. Результаты сохраняются в `output/session-*/`.

## Микрофон

- Разрешение на микрофон запрашивается **в окне расширения** при первом нажатии на «Начать запись» (если переключатель микрофона включён).
- Если доступ был запрещён, разрешите микрофон в настройках Chrome и повторите попытку.

## Настройки

Правый клик по иконке → **«Параметры расширения»**: краткая справка по работе с микрофоном.

## Ограничения

- Захват идёт только с **текущей активной вкладки** (той, на которой вы открыли расширение и нажали «Начать запись»).
